# Exposing runtime data to a Pod in Kubernetes

Sometimes you need some info about the deployment and environment for you application in the Pod.

Of course, there are multiple ways to this:

1. Integrate with the Kubernetes API (effort)
2. Expose the information at deployment time as environment variables and/or files (easier way)

The second option is good where you do not have control over the actual application, but still need the application to have access to this information. A good example is when you need to expose some label value to [filebeats (from Elastic)](https://www.elastic.co/beats/filebeat).

# Quick example

I have tested the example shown below on [k3s](https://k3s.io/) deployed on [multipass nodes](https://multipass.run/) on my local Ubuntu based development machine.

> **Note**
> I have a quick script [available here](https://gist.github.com/nicc777/0f620c9eb2958f58173224f29b23a2ff) - It will setup a k3s cluster on multipass. The process takes about 5 to 10 minutes depending on your Internet speed and system specs. Please adjust the various options in the script to suite your needs. The script is optimized for a system with at least 8 CPU cores and 16GB of RAM.

The following YAML file was taken from the Kubernetes documentation and adjusted to demonstrate how we can expose various runtime information as bot environment variables and information written in a file:

```yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: demo-app
  labels:
    name: demo-app
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  namespace: demo-app
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
        - name: MY_POD_NAME
          valueFrom: {fieldRef: {fieldPath: metadata.name}}
        - name: MY_POD_NAMESPACE
          valueFrom: {fieldRef: {fieldPath: metadata.namespace}}
        volumeMounts:
        - name: podinfo
          mountPath: /etc/podinfo/
      volumes:
      - name: podinfo
        downwardAPI:
          items:
          - path: "labels"
            fieldRef: {fieldPath: metadata.labels}
          - path: "annotations"
            fieldRef: {fieldPath: metadata.annotations}
```



# Tags

kubernetes

<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://nicc777.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>